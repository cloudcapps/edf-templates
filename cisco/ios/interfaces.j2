{% for interface in device.vc_interfaces() -%}
interface {{ interface.name }}
{# Add interface description if present #}
{%- if interface.description != "" %} description {{ interface.description }}{% endif %}
{# For switches, add 'no switchport' to routed physical interfaces #}
{%- if device.role.slug == "switch" and "Vlan" not in interface.name and not interface.vrf %} no switchport{% endif %}
{# For routers, add encapsulation for subinterfaces (dot1q) #}
{%- if device.role.slug == "router" and '.' in interface.name %} encapsulation dot1q {{ interface.name.split('.')[-1] }}{% endif %}
{# For routers, add VRF forwarding if interface is in a VRF #}
{%- if device.role.slug == "router" and interface.vrf %} vrf forwarding {{ interface.vrf.name }}{% endif %}
{# Add all IP addresses for the interface #}
{%- if interface.ip_addresses.all() -%}
{%- for ip in interface.ip_addresses.all() -%}
 ip address {{ ip.address.ip }} {{ ip.address.netmask }}
{%- endfor -%}
{%- endif %}
{# Shutdown or no shutdown depending on interface state #}
{%- if interface.enabled == false %} shutdown
{%- elif interface.enabled == true %} no shutdown
{%- endif %}
{# Switchport/trunk config for switches, non-Vlan interfaces #}
{%- if "Vlan" not in interface.name %}
{%- if device.role.slug == "switch" %}
{%- if interface.mode == "access" %} switchport mode access switchport access vlan {{ interface.untagged_vlan.vid }}
{%- elif interface.mode == "tagged" %} switchport mode trunk switchport trunk allowed vlan {% for vlan in interface.tagged_vlans.all() -%}{{ vlan.vid }}{% if not loop.last %},{% endif %}{%- endfor %}
{%- elif interface.mode and "tagged-all" in interface.mode %} switchport mode trunk switchport trunk allowed vlan all
{%- elif interface.mode is none %}{% endif %}
{# Add channel-group if LAG is present #}
{%- if interface.lag != None %} channel-group {% for char in interface.lag.name -%}{% if char.isdigit() %}{{ char }}{% endif %}{%- endfor %} mode active{% endif %}
{%- endif %}
{%- endif %}
{{ "\n!" }}
{%- endfor %}
